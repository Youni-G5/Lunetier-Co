{% comment %}
  Language & Market Selector - Lunetier
  Uses Shopify native locales and markets
  Usage: {% render 'language-selector' %}
{% endcomment %}

<style>
  /* Trigger Button - Minimal Premium Style */
  .lunetier-locale-trigger {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0;
    background: transparent;
    border: none;
    font-family: var(--font-sans);
    font-size: 0.8125rem;
    color: var(--color-gray-600);
    cursor: pointer;
    transition: color var(--transition-fast);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 500;
  }

  .lunetier-locale-trigger:hover {
    color: var(--color-black);
  }

  .lunetier-locale-trigger svg {
    width: 14px;
    height: 14px;
    transition: transform var(--transition-fast);
  }

  .lunetier-locale-trigger:hover svg {
    transform: translateY(1px);
  }

  /* Modal Overlay */
  .lunetier-locale-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10000;
    padding: 1rem;
    align-items: center;
    justify-content: center;
  }

  .lunetier-locale-modal.active {
    display: flex;
  }

  .lunetier-locale-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(8px);
    animation: fadeIn 0.2s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Modal Content */
  .lunetier-locale-content {
    position: relative;
    background: white;
    max-width: 480px;
    width: 100%;
    max-height: 80vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    animation: slideUp 0.3s ease;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .lunetier-locale-header {
    padding: 2rem 2rem 1.5rem;
    border-bottom: 1px solid var(--color-gray-200);
  }

  .lunetier-locale-header-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.5rem;
  }

  .lunetier-locale-title {
    font-family: var(--font-serif);
    font-size: 1.75rem;
    font-weight: 400;
    margin: 0;
    letter-spacing: -0.01em;
  }

  .lunetier-locale-close {
    background: none;
    border: none;
    padding: 0.25rem;
    cursor: pointer;
    color: var(--color-gray-400);
    transition: color var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .lunetier-locale-close:hover {
    color: var(--color-black);
  }

  .lunetier-locale-subtitle {
    font-family: var(--font-sans);
    font-size: 0.875rem;
    color: var(--color-gray-500);
    margin: 0;
  }

  .lunetier-locale-body {
    padding: 2rem;
    overflow-y: auto;
  }

  /* Section */
  .lunetier-locale-section {
    margin-bottom: 2.5rem;
  }

  .lunetier-locale-section:last-child {
    margin-bottom: 0;
  }

  .lunetier-locale-section-title {
    font-family: var(--font-sans);
    font-size: 0.6875rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-gray-400);
    margin-bottom: 1rem;
    font-weight: 600;
  }

  /* Options List */
  .lunetier-locale-options {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .lunetier-locale-option {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    border: 1px solid transparent;
    cursor: pointer;
    transition: all var(--transition-fast);
    background: var(--color-gray-50);
    font-family: var(--font-sans);
    font-size: 0.9375rem;
    position: relative;
  }

  .lunetier-locale-option:hover {
    background: var(--color-gray-100);
  }

  .lunetier-locale-option.active {
    background: var(--color-black);
    color: var(--color-white);
  }

  .lunetier-locale-option-name {
    font-weight: 500;
  }

  .lunetier-locale-option-code {
    font-size: 0.75rem;
    opacity: 0.6;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .lunetier-locale-option.active .lunetier-locale-option-code {
    opacity: 0.8;
  }

  .lunetier-locale-check {
    width: 18px;
    height: 18px;
    border: 2px solid var(--color-gray-300);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-fast);
  }

  .lunetier-locale-option.active .lunetier-locale-check {
    border-color: var(--color-white);
    background-color: var(--color-white);
  }

  .lunetier-locale-check svg {
    display: none;
    width: 10px;
    height: 10px;
    color: var(--color-black);
  }

  .lunetier-locale-option.active .lunetier-locale-check svg {
    display: block;
  }

  /* Empty State */
  .lunetier-locale-empty {
    text-align: center;
    padding: 2rem 1rem;
    color: var(--color-gray-400);
    font-size: 0.875rem;
  }
</style>

<!-- Trigger Button -->
<button type="button" class="lunetier-locale-trigger" onclick="openLocaleModal()" aria-label="Change language and region">
  <span>{{ localization.language.endonym_name }} ({{ localization.country.currency.iso_code }})</span>
  <svg viewBox="0 0 20 20" fill="currentColor">
    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.974 6 7.5 6A1.5 1.5 0 019 7.5V8a2 2 0 004 0 2 2 0 011.523-1.943A5.977 5.977 0 0116 10c0 .34-.028.675-.083 1H15a2 2 0 00-2 2v2.197A5.973 5.973 0 0110 16v-2a2 2 0 00-2-2 2 2 0 01-2-2 2 2 0 00-1.668-1.973z" clip-rule="evenodd"/>
  </svg>
</button>

<!-- Modal -->
<div class="lunetier-locale-modal" id="localeModal">
  <div class="lunetier-locale-backdrop" onclick="closeLocaleModal()"></div>
  
  <div class="lunetier-locale-content">
    <div class="lunetier-locale-header">
      <div class="lunetier-locale-header-top">
        <h2 class="lunetier-locale-title">Region & Language</h2>
        <button type="button" class="lunetier-locale-close" onclick="closeLocaleModal()" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <line x1="15" y1="5" x2="5" y2="15"></line>
            <line x1="5" y1="5" x2="15" y2="15"></line>
          </svg>
        </button>
      </div>
      <p class="lunetier-locale-subtitle">Choose your preferred shopping experience</p>
    </div>

    <div class="lunetier-locale-body">
      
      {%- if localization.available_countries.size > 1 -%}
        <!-- Countries/Markets -->
        <div class="lunetier-locale-section">
          <h3 class="lunetier-locale-section-title">Country / Region</h3>
          <div class="lunetier-locale-options">
            {%- for country in localization.available_countries -%}
              <button 
                type="button"
                class="lunetier-locale-option {% if country.iso_code == localization.country.iso_code %}active{% endif %}"
                data-country="{{ country.iso_code }}"
                onclick="updateCountry('{{ country.iso_code }}')"
              >
                <div>
                  <div class="lunetier-locale-option-name">{{ country.name }}</div>
                  <div class="lunetier-locale-option-code">{{ country.currency.iso_code }} {{ country.currency.symbol }}</div>
                </div>
                <div class="lunetier-locale-check">
                  <svg viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                </div>
              </button>
            {%- endfor -%}
          </div>
        </div>
      {%- endif -%}

      {%- if localization.available_languages.size > 1 -%}
        <!-- Languages -->
        <div class="lunetier-locale-section">
          <h3 class="lunetier-locale-section-title">Language</h3>
          <div class="lunetier-locale-options">
            {%- for language in localization.available_languages -%}
              <button 
                type="button"
                class="lunetier-locale-option {% if language.iso_code == localization.language.iso_code %}active{% endif %}"
                data-language="{{ language.iso_code }}"
                onclick="updateLanguage('{{ language.iso_code }}')"
              >
                <div>
                  <div class="lunetier-locale-option-name">{{ language.endonym_name }}</div>
                  <div class="lunetier-locale-option-code">{{ language.iso_code }}</div>
                </div>
                <div class="lunetier-locale-check">
                  <svg viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                </div>
              </button>
            {%- endfor -%}
          </div>
        </div>
      {%- endif -%}

      {%- if localization.available_countries.size <= 1 and localization.available_languages.size <= 1 -%}
        <div class="lunetier-locale-empty">
          No other regions or languages available.
        </div>
      {%- endif -%}

    </div>
  </div>
</div>

<script>
  function openLocaleModal() {
    document.getElementById('localeModal').classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function closeLocaleModal() {
    document.getElementById('localeModal').classList.remove('active');
    document.body.style.overflow = '';
  }

  function updateCountry(countryCode) {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/localization';
    
    const countryInput = document.createElement('input');
    countryInput.type = 'hidden';
    countryInput.name = 'country_code';
    countryInput.value = countryCode;
    
    form.appendChild(countryInput);
    document.body.appendChild(form);
    form.submit();
  }

  function updateLanguage(languageCode) {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/localization';
    
    const languageInput = document.createElement('input');
    languageInput.type = 'hidden';
    languageInput.name = 'locale_code';
    languageInput.value = languageCode;
    
    form.appendChild(languageInput);
    document.body.appendChild(form);
    form.submit();
  }

  // Close on Escape
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeLocaleModal();
    }
  });
</script>