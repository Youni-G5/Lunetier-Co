{% comment %}
  Snippet SEO Meta Tags - Lunetier & Co
  Génère tous les meta tags nécessaires pour SEO, Open Graph, Twitter Cards
  
  Usage: {% render 'seo-meta-tags' %}
{% endcomment %}

{%- liquid
  assign page_title = page_title | default: shop.name
  assign page_description = page_description | default: shop.description | default: shop.name
  assign page_image = page_image | default: shop.brand.logo | default: ''
  
  case template.name
    when 'product'
      assign page_title = product.title | append: ' | ' | append: shop.name
      assign page_description = product.description | strip_html | truncatewords: 30
      if product.featured_image
        assign page_image = product.featured_image | image_url: width: 1200
      endif
    when 'collection'
      assign page_title = collection.title | append: ' | ' | append: shop.name
      assign page_description = collection.description | strip_html | truncatewords: 30 | default: 'Découvrez notre collection ' | append: collection.title
      if collection.image
        assign page_image = collection.image | image_url: width: 1200
      endif
    when 'article'
      assign page_title = article.title | append: ' | ' | append: shop.name
      assign page_description = article.excerpt_or_content | strip_html | truncatewords: 30
      if article.image
        assign page_image = article.image | image_url: width: 1200
      endif
    when 'page'
      assign page_title = page.title | append: ' | ' | append: shop.name
      assign page_description = page.content | strip_html | truncatewords: 30
  endcase
-%}

<!-- Meta Tags Essentiels -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="{{ page_description | escape }}">
<meta name="keywords" content="lunettes, lunettes de soleil, optique, {{ product.tags | join: ', ' }}">
<meta name="author" content="{{ shop.name }}">

<!-- Canonical URL -->
<link rel="canonical" href="{{ canonical_url }}">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="{% if template.name == 'product' %}product{% elsif template.name == 'article' %}article{% else %}website{% endif %}">
<meta property="og:title" content="{{ page_title | escape }}">
<meta property="og:description" content="{{ page_description | escape }}">
<meta property="og:url" content="{{ canonical_url }}">
<meta property="og:site_name" content="{{ shop.name }}">
{%- if page_image != blank -%}
  <meta property="og:image" content="https:{{ page_image }}">
  <meta property="og:image:secure_url" content="https:{{ page_image }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
{%- endif -%}

{%- if template.name == 'product' -%}
  <meta property="og:price:amount" content="{{ product.price | money_without_currency | strip_html }}">
  <meta property="og:price:currency" content="{{ cart.currency.iso_code }}">
  <meta property="product:price:amount" content="{{ product.price | money_without_currency | strip_html }}">
  <meta property="product:price:currency" content="{{ cart.currency.iso_code }}">
  <meta property="og:availability" content="{% if product.available %}instock{% else %}oos{% endif %}">
{%- endif -%}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ page_title | escape }}">
<meta name="twitter:description" content="{{ page_description | escape }}">
{%- if page_image != blank -%}
  <meta name="twitter:image" content="https:{{ page_image }}">
{%- endif -%}
{%- if shop.twitter_link != blank -%}
  {%- assign twitter_handle = shop.twitter_link | split: 'twitter.com/' | last | split: '/' | first -%}
  <meta name="twitter:site" content="@{{ twitter_handle }}">
{%- endif -%}

<!-- Pinterest -->
{%- if template.name == 'product' and product.featured_image -%}
  <meta property="og:see_also" content="{{ product.url | prepend: shop.url }}">
{%- endif -%}

<!-- Preconnect vers ressources externes -->
<link rel="preconnect" href="https://cdn.shopify.com" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>

<!-- Favicon -->
{%- if shop.favicon -%}
  <link rel="icon" type="image/png" href="{{ shop.favicon | image_url: width: 32 }}">
  <link rel="apple-touch-icon" href="{{ shop.favicon | image_url: width: 180 }}">
{%- endif -%}

<!-- Robots -->
{%- if template.name == 'search' or template.name == 'cart' -%}
  <meta name="robots" content="noindex, nofollow">
{%- else -%}
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
{%- endif -%}

<!-- Langue -->
<meta property="og:locale" content="{{ request.locale.iso_code | replace: '-', '_' }}">
<link rel="alternate" hreflang="{{ request.locale.iso_code }}" href="{{ canonical_url }}">
