{% comment %}
  Snippet Media - Gère l'affichage des différents types de médias Shopify
  Usage: {% render 'media', media: media %}
{% endcomment %}

{% case media.media_type %}
  {% when 'image' %}
    {%- comment -%}
      Affichage optimisé de l'image avec lazy loading et attributs de taille
    {%- endcomment -%}
    {{ media | image_url: width: 2048 | image_tag: 
      loading: 'lazy', 
      class: 'lunetier-gallery-img', 
      widths: '375, 550, 750, 1100, 1500, 1780, 2048',
      sizes: '(min-width: 1024px) 50vw, 100vw',
      alt: media.alt | escape
    }}

  {% when 'external_video' %}
    {%- comment -%}
      Vidéos externes (YouTube / Vimeo)
      Note: Le conteneur parent gère le ratio, la classe assure le remplissage
    {%- endcomment -%}
    <div class="lunetier-media-wrapper" style="padding-top: {{ 1 | divided_by: media.aspect_ratio | times: 100 }}%; position: relative;">
      {{ media | external_video_tag: class: 'lunetier-gallery-img absolute-full', loading: 'lazy', loop: '1', muted: '1' }}
    </div>

  {% when 'video' %}
    {%- comment -%}
      Vidéos hébergées sur Shopify (MP4)
      Autoplay en boucle et muet pour un effet "Ambiance"
    {%- endcomment -%}
    {{ media | video_tag: 
      image_size: '2048x', 
      autoplay: true, 
      loop: true, 
      controls: true, 
      muted: true,
      preload: 'none',
      class: 'lunetier-gallery-img' 
    }}

  {% when 'model' %}
    {%- comment -%}
      Modèles 3D (.glb) pour la réalité augmentée
    {%- endcomment -%}
    <div class="lunetier-media-wrapper" style="padding-top: 100%; position: relative;">
      {{ media | model_viewer_tag: 
        image_size: '2048x', 
        reveal: 'interaction', 
        toggleable: true, 
        data-model-id: media.id,
        class: 'lunetier-gallery-img absolute-full',
        style: 'position: absolute; top: 0; left: 0; width: 100%; height: 100%;'
      }}
    </div>

  {% else %}
    {{ media | media_tag: class: 'lunetier-gallery-img' }}

{% endcase %}

<style>
  /* Petit utilitaire interne au snippet pour les iframes (Youtube/Model) */
  .lunetier-gallery-img.absolute-full {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  /* Surcharge spécifique pour model-viewer pour éviter les conflits */
  model-viewer.lunetier-gallery-img {
    width: 100%;
    height: 100%;
  }
</style>