{% comment %}
  Section "Collection Capsule" Lunetier - Grille de produits Cross-sell
  Design : Images épurées, effet hover sophistiqué, bouton "Ajouter" qui glisse vers le haut
{% endcomment %}

<style>
  #shopify-section-{{ section.id }} {
    background-color: #ffffff;
    padding-top: 6rem; /* py-24 */
    padding-bottom: 6rem;
  }

  .lunetier-collection-container {
    max-width: 80rem; /* max-w-7xl */
    margin: 0 auto;
    padding: 0 1.5rem; /* px-6 */
  }

  /* --- HEADER SECTION --- */
  .lunetier-collection-header {
    text-align: center;
    margin-bottom: 4rem; /* mb-16 */
  }

  .lunetier-collection-title {
    font-family: serif;
    font-size: 2rem; /* text-3xl */
    font-weight: 500;
    margin-bottom: 1rem;
    color: #111827;
  }

  .lunetier-collection-desc {
    color: #6b7280; /* text-gray-500 */
    font-family: sans-serif;
  }

  /* --- GRID LAYOUT --- */
  .lunetier-product-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem; /* gap-8 */
  }

  @media (min-width: 768px) {
    .lunetier-product-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  /* --- PRODUCT CARD --- */
  .lunetier-card {
    display: block;
    text-decoration: none;
    color: inherit;
    cursor: pointer;
    group: hover; /* concept */
  }

  .lunetier-card-image-wrapper {
    position: relative;
    aspect-ratio: 4 / 5;
    background-color: #f3f4f6; /* bg-gray-100 */
    margin-bottom: 1rem;
    overflow: hidden;
  }

  .lunetier-card-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  /* Hover Effect: Zoom Image */
  .lunetier-card:hover .lunetier-card-img {
    transform: scale(1.05);
  }

  /* --- BADGE (New) --- */
  .lunetier-card-badge {
    position: absolute;
    top: 1rem;
    left: 1rem;
    z-index: 10;
    background-color: #ffffff;
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem; /* text-xs */
    font-weight: 700;
    text-transform: uppercase;
    opacity: 0;
    transition: opacity 0.3s;
    font-family: sans-serif;
  }

  /* Hover Effect: Show Badge */
  .lunetier-card:hover .lunetier-card-badge {
    opacity: 1;
  }

  /* --- SLIDE-UP BUTTON --- */
  .lunetier-card-btn {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: #000000;
    color: #ffffff;
    padding: 1rem 0;
    text-align: center;
    font-size: 0.875rem; /* text-sm */
    font-weight: 500;
    text-transform: uppercase;
    border: none;
    cursor: pointer;
    
    /* Animation settings */
    transform: translateY(100%); /* Caché en bas par défaut */
    transition: transform 0.3s ease-out;
    font-family: sans-serif;
  }

  /* Hover Effect: Slide Up Button */
  .lunetier-card:hover .lunetier-card-btn {
    transform: translateY(0);
  }

  .lunetier-card-btn:hover {
    background-color: #1f2937; /* gray-800 */
  }

  /* --- INFO --- */
  .lunetier-card-info {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    font-family: sans-serif;
  }

  .lunetier-card-title {
    font-size: 1.125rem; /* text-lg */
    font-weight: 500;
    margin: 0;
    color: #111827;
  }

  .lunetier-card-meta {
    font-size: 0.875rem; /* text-sm */
    color: #6b7280; /* text-gray-500 */
    margin-top: 0.25rem;
  }

  .lunetier-card-price {
    font-weight: 500;
    color: #111827;
  }
</style>

<div class="lunetier-collection-container">
  
  <!-- HEADER -->
  <div class="lunetier-collection-header">
    <h2 class="lunetier-collection-title">
      {{ section.settings.title | default: "La Collection Capsule" }}
    </h2>
    <p class="lunetier-collection-desc">
      {{ section.settings.description | default: "Quelques pièces exclusives pour compléter votre style." }}
    </p>
  </div>

  <!-- GRID -->
  <div class="lunetier-product-grid">
    {%- assign collection = collections[section.settings.collection] -%}
    
    {%- if collection != blank -%}
      {%- for product in collection.products limit: section.settings.limit -%}
        <div class="lunetier-card-wrapper">
          <!-- Le lien englobe tout pour le clic, mais contient un formulaire pour le bouton -->
          <a href="{{ product.url }}" class="lunetier-card">
            
            <div class="lunetier-card-image-wrapper">
              <!-- BADGE -->
              {%- assign product_date_ts = product.created_at | date: '%s' | plus: 0 -%}
              {%- assign now_ts = 'now' | date: '%s' | plus: 0 -%}
              {%- assign new_threshold = now_ts | minus: 2592000 -%}

              {%- if product.available and product.compare_at_price > product.price -%}
                 <span class="lunetier-card-badge">Promo</span>
              {%- elsif product.tags contains 'nouveau' or product_date_ts > new_threshold -%}
                 <span class="lunetier-card-badge">Nouveau</span>
              {%- endif -%}

              <!-- IMAGE -->
              {%- if product.featured_image != blank -%}
                {{ product.featured_image | image_url: width: 800 | image_tag: 
                  loading: 'lazy', 
                  class: 'lunetier-card-img',
                  alt: product.title
                }}
              {%- else -%}
                {{ 'product-1' | placeholder_svg_tag: 'lunetier-card-img' }}
              {%- endif -%}

              <!-- BUTTON (FAKE ADD TO CART -> REDIRECTS TO PRODUCT OR USES FORM) -->
              <!-- Pour simplifier sans JS complexe, ce bouton redirige vers la fiche produit -->
              <div class="lunetier-card-btn">
                Voir - {{ product.price | money_without_trailing_zeros }}
              </div>
            </div>

            <div class="lunetier-card-info">
              <div>
                <h3 class="lunetier-card-title">{{ product.title }}</h3>
                <p class="lunetier-card-meta">
                   {% comment %} Essayer d'afficher le type ou une brève description {% endcomment %}
                   {{ product.type | default: "Acétate Italien" }}
                </p>
              </div>
              <span class="lunetier-card-price">{{ product.price | money_without_trailing_zeros }}</span>
            </div>

          </a>
        </div>
      {%- endfor -%}
    {%- else -%}
      <!-- PLACEHOLDER CONTENT (Si aucune collection sélectionnée) -->
      {%- for i in (1..3) -%}
        <a href="#" class="lunetier-card">
          <div class="lunetier-card-image-wrapper">
            <span class="lunetier-card-badge">Nouveau</span>
            {{ 'product-' | append: i | placeholder_svg_tag: 'lunetier-card-img' }}
            <div class="lunetier-card-btn">Ajouter - 129€</div>
          </div>
          <div class="lunetier-card-info">
            <div>
              <h3 class="lunetier-card-title">Nom du Modèle</h3>
              <p class="lunetier-card-meta">Acétate Italien</p>
            </div>
            <span class="lunetier-card-price">129 €</span>
          </div>
        </a>
      {%- endfor -%}
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "Collection Capsule",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Titre",
      "default": "La Collection Capsule"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Quelques pièces exclusives pour compléter votre style."
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Choisir la collection"
    },
    {
      "type": "range",
      "id": "limit",
      "min": 3,
      "max": 9,
      "step": 3,
      "default": 3,
      "label": "Nombre de produits"
    }
  ],
  "presets": [
    {
      "name": "Collection Capsule Lunetier"
    }
  ]
}
{% endschema %}