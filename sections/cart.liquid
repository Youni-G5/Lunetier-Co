{% comment %}
  Section Panier "Lunetier" - Design Clean
  Optimisé : CSS externe dans assets/cart.css
{% endcomment %}

<div class="lunetier-cart-section">
  <div class="lunetier-cart-container">
    
    <h1 class="lunetier-cart-title">Panier</h1>

    {%- if cart.item_count > 0 -%}
      
      <form action="{{ routes.cart_url }}" method="post" class="lunetier-cart-form">
        
        <div class="lunetier-cart-grid">
          
          <!-- COLONNE GAUCHE : ITEMS -->
          <div class="lunetier-cart-items">
            {%- for item in cart.items -%}
              <div class="lunetier-cart-item" data-line="{{ forloop.index }}">
                
                <div class="lunetier-cart-item-image">
                  {%- if item.image -%}
                    {% render 'responsive-image',
                      image: item.image,
                      sizes: '150px',
                      loading: 'lazy',
                      class: 'lunetier-cart-img',
                      alt: item.title
                    %}
                  {%- else -%}
                    {{ 'product-1' | placeholder_svg_tag: 'lunetier-cart-img' }}
                  {%- endif -%}
                </div>

                <div class="lunetier-cart-item-details">
                  <h3 class="lunetier-cart-item-title">
                    <a href="{{ item.url }}">{{ item.product.title }}</a>
                  </h3>
                  
                  {%- unless item.variant.title == 'Default Title' -%}
                    <p class="lunetier-cart-item-variant">{{ item.variant.title }}</p>
                  {%- endunless -%}

                  <div class="lunetier-cart-item-actions">
                    <div class="lunetier-cart-qty">
                      <button type="button" class="lunetier-cart-qty-btn" onclick="updateQuantity({{ forloop.index }}, -1)" aria-label="Diminuer la quantité">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                      </button>
                      <input type="number" 
                             name="updates[]" 
                             value="{{ item.quantity }}" 
                             min="0" 
                             class="lunetier-cart-qty-input"
                             data-line="{{ forloop.index }}"
                             aria-label="Quantité">
                      <button type="button" class="lunetier-cart-qty-btn" onclick="updateQuantity({{ forloop.index }}, 1)" aria-label="Augmenter la quantité">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                      </button>
                    </div>

                    <button type="button" class="lunetier-cart-remove" onclick="removeItem({{ forloop.index }})" aria-label="Retirer cet article">
                      Retirer
                    </button>
                  </div>
                </div>

                <div class="lunetier-cart-item-price">
                  {{ item.line_price | money }}
                </div>

              </div>
            {%- endfor -%}
          </div>

          <!-- COLONNE DROITE : RÉSUMÉ -->
          <div class="lunetier-cart-summary">
            <h2 class="lunetier-cart-summary-title">Résumé</h2>
            
            <div class="lunetier-cart-summary-row">
              <span>Sous-total</span>
              <span>{{ cart.total_price | money }}</span>
            </div>

            <div class="lunetier-cart-summary-row">
              <span>Livraison</span>
              <span>Offerte</span>
            </div>

            <div class="lunetier-cart-shipping-bar">
              <div class="lunetier-cart-shipping-progress" style="width: {% if cart.total_price >= 5000 %}100{% else %}{{ cart.total_price | times: 100 | divided_by: 5000 }}{% endif %}%;"></div>
            </div>
            <p class="lunetier-cart-shipping-text">
              {%- if cart.total_price >= 5000 -%}
                ✅ Livraison express gratuite débloquée !
              {%- else -%}
                {%- assign remaining = 5000 | minus: cart.total_price -%}
                Plus que {{ remaining | money }} pour la livraison express gratuite
              {%- endif -%}
            </p>

            <div class="lunetier-cart-total">
              <span>Total</span>
              <span>{{ cart.total_price | money }}</span>
            </div>

            <button type="submit" name="checkout" class="lunetier-cart-checkout-btn">
              Passer commande
            </button>

            <a href="{{ routes.all_products_collection_url }}" class="lunetier-cart-continue">
              Continuer mes achats
            </a>
          </div>

        </div>
      </form>

    {%- else -%}
      
      <div class="lunetier-cart-empty">
        <p>Votre panier est vide</p>
        <a href="{{ routes.all_products_collection_url }}" class="lunetier-cart-shop-btn">
          Découvrir la collection
        </a>
      </div>

    {%- endif -%}

  </div>
</div>

{% comment %}
  JavaScript déplacé dans assets/theme.js :
  - updateQuantity()
  - removeItem()
  - Auto-update cart
{% endcomment %}

{% schema %}
{
  "name": "Page Panier",
  "settings": []
}
{% endschema %}
