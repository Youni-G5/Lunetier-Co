{% comment %}
  Section Password "Lunetier"
  Design : Teasing minimaliste, capture d'emails, accès boutique discret.
{% endcomment %}

<style>
  /* --- GLOBAL & VARS --- */
  :root {
    --lunetier-bg: #000000;
    --lunetier-text: #ffffff;
    --lunetier-font-serif: ui-serif, Georgia, Cambria, "Times New Roman", Times, serif;
    --lunetier-font-sans: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  .lunetier-password-section {
    background-color: var(--lunetier-bg);
    color: var(--lunetier-text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 2rem;
    position: relative;
    overflow: hidden;
  }

  /* --- BACKGROUND IMAGE (Optional) --- */
  .lunetier-bg-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.4;
    z-index: 0;
    filter: grayscale(100%);
  }
  
  /* Overlay gradient */
  .lunetier-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.8) 100%);
    z-index: 1;
  }

  .lunetier-content {
    position: relative;
    z-index: 10;
    max-width: 32rem;
    width: 100%;
  }

  /* --- TYPOGRAPHY --- */
  .lunetier-brand {
    font-family: var(--lunetier-font-serif);
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    margin-bottom: 4rem;
    display: inline-block;
  }

  .lunetier-headline {
    font-family: var(--lunetier-font-serif);
    font-size: 3rem; /* text-5xl */
    line-height: 1.1;
    font-weight: 400;
    margin-bottom: 1.5rem;
  }
  
  @media (min-width: 768px) {
    .lunetier-headline { font-size: 4rem; }
  }

  .lunetier-subtext {
    font-family: var(--lunetier-font-sans);
    font-size: 1rem;
    line-height: 1.6;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 3rem;
  }

  /* --- NEWSLETTER FORM --- */
  .lunetier-newsletter-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    width: 100%;
  }

  @media (min-width: 640px) {
    .lunetier-newsletter-form {
      flex-direction: row;
      border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      padding-bottom: 0.5rem;
    }
  }

  .lunetier-email-input {
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #fff;
    padding: 1rem;
    font-family: var(--lunetier-font-sans);
    font-size: 0.875rem;
    width: 100%;
    border-radius: 0;
  }
  
  @media (min-width: 640px) {
    .lunetier-email-input {
      border: none;
      padding: 0.5rem 0;
    }
  }

  .lunetier-email-input::placeholder {
    color: rgba(255, 255, 255, 0.5);
  }
  
  .lunetier-email-input:focus {
    outline: none;
    border-color: #fff;
  }

  .lunetier-submit-btn {
    background-color: #fff;
    color: #000;
    border: none;
    padding: 1rem 2rem;
    text-transform: uppercase;
    font-weight: 700;
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    cursor: pointer;
    transition: opacity 0.2s;
    white-space: nowrap;
  }
  
  .lunetier-submit-btn:hover { opacity: 0.9; }

  /* Message succès/erreur */
  .lunetier-form-message {
    margin-top: 1rem;
    font-size: 0.875rem;
    color: #4ade80; /* green-400 */
  }

  /* --- FOOTER & LOGIN LINK --- */
  .lunetier-footer {
    position: absolute;
    bottom: 2rem;
    width: 100%;
    text-align: center;
    z-index: 10;
    font-family: var(--lunetier-font-sans);
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.4);
  }

  .lunetier-login-toggle {
    background: none;
    border: none;
    color: inherit;
    text-decoration: underline;
    cursor: pointer;
    margin-top: 0.5rem;
    padding: 0.5rem;
  }
  
  .lunetier-login-toggle:hover { color: #fff; }

  /* --- MODAL LOGIN --- */
  .lunetier-modal {
    position: fixed;
    inset: 0;
    background-color: rgba(0,0,0,0.95);
    z-index: 50;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  
  .lunetier-modal.is-open {
    opacity: 1;
    pointer-events: auto;
  }

  .lunetier-modal-content {
    background: #111;
    padding: 3rem;
    max-width: 24rem;
    width: 90%;
    border: 1px solid #333;
    text-align: center;
    position: relative;
  }

  .lunetier-close-modal {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    padding: 0.5rem;
  }

  .lunetier-password-input {
    width: 100%;
    background: #000;
    border: 1px solid #333;
    color: #fff;
    padding: 0.75rem;
    margin-bottom: 1rem;
    font-family: var(--lunetier-font-sans);
  }
  
  .lunetier-enter-btn {
    width: 100%;
    background: #fff;
    color: #000;
    border: none;
    padding: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    cursor: pointer;
  }
</style>

<div class="lunetier-password-section">
  
  <!-- BACKGROUND -->
  {%- if section.settings.image != blank -%}
    {{ section.settings.image | image_url: width: 2000 | image_tag: 
      class: 'lunetier-bg-image',
      loading: 'eager'
    }}
  {%- endif -%}
  <div class="lunetier-overlay"></div>

  <!-- MAIN CONTENT -->
  <div class="lunetier-content">
    <div class="lunetier-brand">{{ shop.name }}</div>
    
    <h1 class="lunetier-headline">{{ section.settings.heading | default: "Bientôt Disponible" }}</h1>
    
    <div class="lunetier-subtext">
      {{ section.settings.subtext | default: "Nous peaufinons les derniers détails. Inscrivez-vous pour être le premier informé du lancement et recevoir une offre exclusive." }}
    </div>

    <!-- NEWSLETTER FORM -->
    {% form 'customer', class: 'lunetier-form-wrapper' %}
      {% if form.posted_successfully? %}
        <p class="lunetier-form-message">Merci ! Vous êtes inscrit.</p>
      {% else %}
        <div class="lunetier-newsletter-form">
          <input type="hidden" name="contact[tags]" value="newsletter">
          <input 
            type="email" 
            name="contact[email]" 
            class="lunetier-email-input" 
            placeholder="Votre adresse email" 
            required
            aria-label="Email"
          >
          <button type="submit" class="lunetier-submit-btn">S'inscrire</button>
        </div>
        {% if form.errors %}
          <p class="lunetier-form-message" style="color:#ef4444;">{{ form.errors.messages['email'] }}</p>
        {% endif %}
      {% endif %}
    {% endform %}
  </div>

  <!-- FOOTER -->
  <div class="lunetier-footer">
    <p>&copy; {{ 'now' | date: "%Y" }} {{ shop.name }}. Tous droits réservés.</p>
    <button onclick="toggleModal()" class="lunetier-login-toggle">
      Entrer avec le mot de passe
    </button>
  </div>

</div>

<!-- LOGIN MODAL -->
<div id="password-modal" class="lunetier-modal">
  <div class="lunetier-modal-content">
    <button onclick="toggleModal()" class="lunetier-close-modal">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
    </button>
    
    <h3 style="margin-bottom:1.5rem; font-family:serif; font-size:1.5rem;">Accès Boutique</h3>
    
    {% form 'storefront_password' %}
      {% if form.errors %}
        <p style="color:#ef4444; font-size:0.875rem; margin-bottom:1rem;">Mot de passe incorrect</p>
      {% endif %}
      
      <input 
        type="password" 
        name="password" 
        class="lunetier-password-input" 
        placeholder="Mot de passe"
        required
      >
      <button type="submit" class="lunetier-enter-btn">Entrer</button>
    {% endform %}
    
    <p style="margin-top:1rem; font-size:0.75rem; color:#666;">
      Vous êtes le propriétaire ? <a href="/admin" style="color:#888; text-decoration:underline;">Connectez-vous ici</a>
    </p>
  </div>
</div>

<script>
  function toggleModal() {
    const modal = document.getElementById('password-modal');
    modal.classList.toggle('is-open');
    
    // Focus sur l'input si ouverture
    if (modal.classList.contains('is-open')) {
      setTimeout(() => modal.querySelector('input').focus(), 100);
    }
  }

  // Ouvrir automatiquement si erreur (après tentative de login échouée)
  {% if form.errors %}
    toggleModal();
  {% endif %}
</script>

{% schema %}
{
  "name": "Page Password",
  "settings": [
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image de fond"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Titre Principal",
      "default": "Bientôt Disponible"
    },
    {
      "type": "textarea",
      "id": "subtext",
      "label": "Texte d'introduction",
      "default": "Nous peaufinons les derniers détails. Inscrivez-vous pour être le premier informé du lancement."
    }
  ]
}
{% endschema %}