{% comment %}
  Product Section "Lunetier" - Premium Design
  Optimized: External CSS in assets/product.css
{% endcomment %}

<div class="lunetier-prod-section">
  <div class="lunetier-prod-container">
    
    {%- form 'product', product, id: 'product-form-lunetier', class: 'product-form' -%}
      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" id="selected-variant-id">

      <div class="lunetier-prod-grid">
        
        <!-- GALLERY -->
        <div class="lunetier-prod-gallery">
          {%- if product.media.size > 0 -%}
            {%- for media in product.media limit: 6 -%}
              <div class="lunetier-prod-media-item">
                {%- if media.media_type == 'image' -%}
                  {% render 'responsive-image',
                    image: media,
                    sizes: '(min-width: 1024px) 50vw, 100vw',
                    loading: 'eager',
                    class: 'lunetier-prod-img',
                    alt: media.alt | default: product.title
                  %}
                {%- else -%}
                  {% render 'media', media: media %}
                {%- endif -%}
              </div>
            {%- endfor -%}
          {%- else -%}
            <div class="lunetier-prod-media-item">
              {{ 'product-1' | placeholder_svg_tag: 'lunetier-prod-img' }}
            </div>
          {%- endif -%}
        </div>

        <!-- STICKY DETAILS -->
        <div class="lunetier-prod-details">
          
          <div class="lunetier-prod-collection">
            {{ product.vendor | default: "Signature Collection" }}
          </div>
          
          <h1 class="lunetier-prod-title">{{ product.title }}</h1>
          
          <div class="lunetier-prod-meta-row">
            <span class="lunetier-prod-price">{{ product.price | money }}</span>
            <div class="lunetier-prod-rating" role="img" aria-label="5 star rating out of 5">
              <div style="display:flex;">
                {%- for i in (1..5) -%}
                  <svg class="lunetier-prod-star" viewBox="0 0 24 24" aria-hidden="true"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                {%- endfor -%}
              </div>
              <span>(48 reviews)</span>
            </div>
          </div>

          <div class="lunetier-prod-desc">
            {{ product.description | strip_html | truncatewords: 35 }}
          </div>

          {%- unless product.has_only_default_variant -%}
            <div class="lunetier-prod-variants">
              {%- for option in product.options_with_values -%}
                <span class="lunetier-prod-variant-label">{{ option.name }}: <span id="selected-option-{{ forloop.index0 }}">{{ option.selected_value }}</span></span>
                <div class="lunetier-prod-options-group" role="group" aria-label="{{ option.name }}">
                  {%- for value in option.values -%}
                    <label>
                      <input type="radio" 
                             name="option-{{ option.name | handleize }}" 
                             value="{{ value | escape }}"
                             class="lunetier-prod-radio-input"
                             data-option-index="{{ forloop.parentloop.index0 }}"
                             {% if option.selected_value == value %}checked{% endif %}
                             aria-label="{{ option.name }} {{ value }}">
                      <span class="lunetier-prod-radio-btn">{{ value }}</span>
                    </label>
                  {%- endfor -%}
                </div>
              {%- endfor -%}
            </div>
          {%- endunless -%}

          <div class="lunetier-prod-fit">
            <div class="lunetier-prod-fit-title">Fit Guide</div>
            <div class="lunetier-prod-fit-bar">
              {%- assign fit_pos = '50%' -%}
              {%- if section.settings.fit_type == 'narrow' %}{% assign fit_pos = '15%' %}{% endif -%}
              {%- if section.settings.fit_type == 'wide' %}{% assign fit_pos = '85%' %}{% endif -%}
              <div class="lunetier-prod-fit-dot" style="left: {{ fit_pos }};"></div>
            </div>
            <div class="lunetier-prod-fit-labels">
              <span>Narrow</span>
              <span>Medium</span>
              <span>Wide</span>
            </div>
          </div>

          <div class="lunetier-prod-actions">
            <button type="submit" name="add" class="lunetier-prod-btn-primary" 
                    {% unless product.available %}disabled{% endunless %}
                    aria-label="Add {{ product.title }} to cart">
              {%- if product.available -%}
                Add to cart - {{ product.price | money }}
              {%- else -%}
                Sold Out
              {%- endif -%}
            </button>
            <button type="button" 
                    class="lunetier-prod-btn-secondary" 
                    onclick="openVirtualTryOn()" 
                    aria-label="Try virtually">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin-right:0.35rem;">
                <rect x="2" y="6" width="20" height="14" rx="2"></rect>
                <circle cx="12" cy="13" r="3"></circle>
                <path d="M16 6l2-3h-12l2 3"></path>
              </svg>
              Virtual Try-On (Beta)
            </button>
          </div>

          <div class="lunetier-prod-accordions">
            
            <details class="lunetier-prod-accordion-item" open>
              <summary class="lunetier-prod-summary">
                <span class="lunetier-prod-summary-title">Description & Design</span>
                <span class="lunetier-prod-icon" aria-hidden="true"></span>
              </summary>
              <div class="lunetier-prod-accordion-content">
                {{ product.description }}
              </div>
            </details>

            <details class="lunetier-prod-accordion-item">
              <summary class="lunetier-prod-summary">
                <span class="lunetier-prod-summary-title">Dimensions</span>
                <span class="lunetier-prod-icon" aria-hidden="true"></span>
              </summary>
              <div class="lunetier-prod-accordion-content">
                <ul style="padding-left:1.2rem; margin:0;">
                  <li>Total width: 140mm</li>
                  <li>Lenses: 48mm</li>
                  <li>Bridge: 22mm</li>
                  <li>Temples: 145mm</li>
                </ul>
              </div>
            </details>

            <details class="lunetier-prod-accordion-item">
              <summary class="lunetier-prod-summary">
                <span class="lunetier-prod-summary-title">Shipping & Returns</span>
                <span class="lunetier-prod-icon" aria-hidden="true"></span>
              </summary>
              <div class="lunetier-prod-accordion-content">
                <p style="margin:0;">Free express shipping (24-48h). Try them at home for 30 days. If they don't suit you, return is free and immediate.</p>
              </div>
            </details>

          </div>

          <div class="lunetier-prod-trust">
            <div class="lunetier-prod-trust-item">
              <svg class="lunetier-prod-trust-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
              <span class="lunetier-prod-trust-text">2 Year Warranty</span>
            </div>
            <div class="lunetier-prod-trust-item">
              <svg class="lunetier-prod-trust-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg>
              <span class="lunetier-prod-trust-text">24h Delivery</span>
            </div>
            <div class="lunetier-prod-trust-item">
              <svg class="lunetier-prod-trust-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
              <span class="lunetier-prod-trust-text">Free Returns</span>
            </div>
          </div>

        </div>
      </div>

      <div class="lunetier-prod-mobile-sticky">
        <div class="lunetier-prod-mobile-info">
          <div class="lunetier-prod-mobile-title">{{ product.title }}</div>
          <div class="lunetier-prod-mobile-variant">
            {% unless product.has_only_default_variant %}
              {{ product.selected_or_first_available_variant.title }}
            {% else %}
               One size
            {% endunless %}
          </div>
        </div>
        <button type="submit" name="add" class="lunetier-prod-mobile-btn" 
                {% unless product.available %}disabled{% endunless %}
                aria-label="Add to cart">
           Add - {{ product.price | money }}
        </button>
      </div>

    {%- endform -%}
  </div>
</div>

{% comment %}
  JavaScript moved to assets/theme.js:
  - updateVariant()
  - Combined variants management
  - Image update based on variant
{% endcomment %}

{% schema %}
{
  "name": "Product Page Lunetier",
  "settings": [
    {
      "type": "select",
      "id": "fit_type",
      "label": "Fit Type (Default)",
      "options": [
        { "value": "narrow", "label": "Narrow" },
        { "value": "medium", "label": "Medium" },
        { "value": "wide", "label": "Wide" }
      ],
      "default": "medium"
    }
  ]
}
{% endschema %}